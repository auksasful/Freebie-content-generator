from fpdf import FPDF
import os
from tkinter import messagebox

def export_to_pdf(self):
    def add_url_to_page(pdf, url):
        pdf.set_font("Arial", size=12)
        pdf.set_text_color(0, 0, 255)
        pdf.cell(0, 10, url, 0, 1, 'C', link=url)
        pdf.ln(5)  # Add a little space after the URL

    # export the pages to PDF from liked_images folder
    pdf = FPDF()
    liked_images_folder = os.path.join(self.project_pages_path, 'liked_images')

    if not os.path.exists(liked_images_folder):
        messagebox.showinfo("Info", "No liked images found to export.")
        return

    image_files = [f for f in os.listdir(liked_images_folder) if f.lower().endswith(('png', 'jpg', 'jpeg'))]

    if not image_files:
        messagebox.showinfo("Info", "No liked images found to export.")
        return

    # Check for cover image and move it to the first place
    cover_image = None
    for image_file in image_files:
        if image_file.startswith('cover;'):
            cover_image = image_file
            break

    if cover_image:
        image_files.remove(cover_image)
        image_files.insert(0, cover_image)

    # Add the cover image page
    image_path = os.path.join(liked_images_folder, image_files[0])
    pdf.add_page()
    pdf.image(image_path, x=10, y=10, w=pdf.w - 20)

    # Add the rest of the images with the URL at the top of each page
    url = "http://your-link-here.com"
    for image_file in image_files[1:]:
        image_path = os.path.join(liked_images_folder, image_file)
        pdf.add_page()
        add_url_to_page(pdf, url)
        pdf.image(image_path, x=10, y=20, w=pdf.w - 20)  # Adjusted y to place image below URL

    output_pdf_path = os.path.join(self.project_path, 'recipe_book.pdf')
    pdf.output(output_pdf_path)
    messagebox.showinfo("Info", f"PDF exported successfully to {output_pdf_path}")

